<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>post generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

</head>
<body>
  <script>

  var body = {
   "method": "send_lead",
   "name": "max",
   "ip": "127.0.01",
   "phone": "+7921000000"
  }

  let xhr = new XMLHttpRequest();
  xhr.open("POST", 'http://localhost:8080/', true);

  //отправляем первый POST запрос, в ответ получаем API-ключ
  xhr.onreadystatechange = () => {
      if (xhr.readyState === 4 && xhr.status === 200) {
          var apiKey = JSON.parse(xhr.responseText);

          //получили API-ключ, отправляем POST запрос c данными
          send_data(apiKey);
      }
  };
  xhr.send();  

  function send_data(apiKey) {
    let xhr = new XMLHttpRequest();
    xhr.open("POST", 'http://localhost:8080/', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

    xhr.onreadystatechange = () => {
        if (xhr.readyState === 4 && xhr.status === 200) {
            var json = JSON.parse(xhr.responseText);
            console.log(json);          
        }
    };

    body["key"] = apiKey["key"];

    xhr.send(JSON.stringify(body));
  }

</script>
</body>
</html>